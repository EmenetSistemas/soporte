<div class="col-12 dashboard" style="margin-bottom: -5px;">
    <div class="card">
        <div class="filter">
            <span *ngIf="data.datosEquipo && data.datosEquipo.status == 1"
                class="badge bg-warning text-dark">&nbsp;Servicio pendiente&nbsp;</span>
            <span *ngIf="data.datosEquipo && data.datosEquipo.status == 2" class="badge bg-primary">&nbsp;Servicio
                concluido&nbsp;</span>
            <span *ngIf="data.datosEquipo && data.datosEquipo.status == 3" class="badge bg-success">&nbsp;Servicio
                entregado&nbsp;</span>
            <span *ngIf="data.datosEquipo && data.datosEquipo.status == 4" class="badge bg-danger">&nbsp;Servicio
                cancelado&nbsp;</span>

            &nbsp;

            <span
                *ngIf="formEquipo.valid && (!data.datosEquipo || data.datosEquipo?.status == 1 || data.datosEquipo?.status == 2)"
                class="badge bg-success">
                &nbsp;<i class="bi bi-check-circle me-1"></i>
            </span>
            <span
                *ngIf="!formEquipo.valid && (!data.datosEquipo || data.datosEquipo?.status == 1 || data.datosEquipo?.status == 2)"
                class="badge bg-warning text-dark">
                &nbsp;<i class="bi bi-exclamation-triangle me-1"></i>
            </span>
        </div>
        <div class="card-body">
            <div class="col-12" style="margin-top: 15px !important;">
                <div class="row">
                    <form class="row g-3" autocomplete="off" [formGroup]="formEquipo" (input)="enviarCambios()">
                        <div class="col-xxl-3 col-lg-4 col-sm-3 d-flex justify-content-center align-items-center"
                            data-bs-toggle="dropdown">
                            <img src="https://m-net.mx/scosm/images/{{data.itemType}}.png" width="100px">
                        </div>

                        <ul class="dropdown-menu">
                            <ng-container *ngIf="
                                data.datosEquipo &&
                                ((data.datosEquipo.usuarioModificacion && data.datosEquipo.fechaModificacion) ||
                                (data.datosEquipo.usuarioCancelacion && data.datosEquipo.fechaCancelacion) ||
                                (data.datosEquipo.usuarioConclucion && data.datosEquipo.fechaConclucion) ||
                                (data.datosEquipo.usuarioEntrega && data.datosEquipo.fechaEntrega)); else sinActualizaciones
                            ">
                                <div class="t-center">
                                    <div
                                        *ngIf="data.datosEquipo.usuarioModificacion && data.datosEquipo.fechaModificacion">
                                        <label style="color: gray !important;">Última
                                            actualización</label>&nbsp;<label
                                            style="color: #008FFF !important;">{{data.datosEquipo.usuarioModificacion}}</label>
                                        <br><label>{{data.datosEquipo.fechaModificacion}}</label>
                                        <hr>
                                    </div>

                                    <div
                                        *ngIf="data.datosEquipo.usuarioCancelacion && data.datosEquipo.fechaCancelacion">
                                        <label style="color: gray !important;">Cancelado por</label>&nbsp;<label
                                            style="color: #008FFF !important;">{{data.datosEquipo.usuarioCancelacion}}</label>
                                        <br><label>{{data.datosEquipo.fechaCancelacion}}</label>
                                    </div>
                                    <div *ngIf="data.datosEquipo.usuarioConclucion && data.datosEquipo.fechaConclucion">
                                        <label style="color: gray !important;">Concluido por</label>&nbsp;<label
                                            style="color: #008FFF !important;">{{data.datosEquipo.usuarioConclucion}}</label>
                                        <br><label>{{data.datosEquipo.fechaConclucion}}</label>
                                    </div>
                                </div>
                            </ng-container>
                        </ul>

                        <ng-template #sinActualizaciones>
                            <div class="t-center">
                                Aún no hay actualizaciones para mostrar
                            </div>
                        </ng-template>

                        <div class="col-xxl-9 col-lg-8 col-sm-9">
                            <div class="row g-3">
                                <div [ngClass]="{
                                    'col-xxl-4 col-lg-6 col-sm-4': data.itemType != 'impresora' && data.itemType != 'monitor',
                                    'col-sm-6': data.itemType == 'impresora' || data.itemType == 'monitor'
                                }">
                                    <label class="form-label required">Equipo:</label>
                                    <input type="text" class="form-control" placeholder="Equipo"
                                        formControlName="equipo" (keypress)="soloTexto($event)">
                                </div>
                                <div *ngIf="data.itemType != 'impresora' && data.itemType != 'monitor'"
                                    class="col-xxl-4 col-lg-6 col-sm-4">
                                    <label class="form-label">Contraseña:</label>
                                    <input type="text" class="form-control" placeholder="Contraseña"
                                        formControlName="password" (keypress)="soloTexto($event)">
                                </div>
                                <div [ngClass]="{
                                    'col-xxl-4 col-lg-12 col-sm-4': data.itemType != 'impresora' && data.itemType != 'monitor',
                                    'col-sm-6': data.itemType == 'impresora' || data.itemType == 'monitor'
                                }">
                                    <label class="form-label">No. Serie:</label>
                                    <input type="text" class="form-control" placeholder="No. Serie"
                                        formControlName="noSerie" (keypress)="soloTexto($event)">
                                </div>
                                <div class="col-xxl-6 col-lg-6 col-sm-6">
                                    <label class="form-label">Descripción falla:</label>
                                    <textarea class="form-control" placeholder="Descripción falla"
                                        formControlName="descripcionFalla" (keypress)="soloTexto($event)"
                                        rows="2"></textarea>
                                </div>
                                <div class="col-xxl-6 col-lg-6 col-sm-6">
                                    <label class="form-label">Observaciones:</label>
                                    <textarea class="form-control" placeholder="Observaciones"
                                        formControlName="observaciones" (keypress)="soloTexto($event)"
                                        rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div *ngFor="let check of checks" class="form-check form-switch f-left">
                                <input class="form-check-input" type="checkbox" id="{{check.identificador+data.idItem}}"
                                    [checked]="check.checked" (change)="cambioCheck(check)"
                                    [disabled]="this.data.datosEquipo && this.data.datosEquipo.status == 4">
                                <label class="form-check-label"
                                    for="{{check.identificador+data.idItem}}">{{check.label}}</label>
                            </div>
                        </div>
                        <div *ngIf="data.datosEquipo" class="col-sm-5">
                            <label class="form-label">Diagnóstico final:</label>
                            <textarea class="form-control" placeholder="Diagnóstico final"
                                formControlName="diagnosticoFinal" (keypress)="soloTexto($event)" rows="2"></textarea>
                        </div>
                        <div [ngClass]="{'col-sm-10': !data.datosEquipo, 'col-sm-5': data.datosEquipo}">
                            <label class="form-label">Detalles:</label>
                            <textarea class="form-control" placeholder="Detalles" formControlName="detalles"
                                (keypress)="soloTexto($event)" rows="2"></textarea>
                        </div>
                        <div class="col-sm-2">
                            <label class="form-label required">Costo:</label>
                            <input type="text" class="form-control t-center" placeholder="Costo"
                                formControlName="costoReparacion" (keypress)="soloNumeros($event)" maxlength="11"
                                (input)="moneyFormat($event)">
                        </div>
                    </form>
                    <div class="col-12" style="margin-top: 15px;">
                        <section *ngIf="!data.datosEquipo" class="d-flex justify-content-end">
                            <div class="btn btn-warning me-2" (click)="limpiarFormulario()">Limpiar</div>
                            <div class="btn btn-danger me-2 t-bold" (click)="parent.removeContent(data.idItem)">X</div>
                        </section>
                        <section *ngIf="data.datosEquipo">
                            <div *ngIf="data.datosEquipo.status <= 2" class="btn btn-primary me-2"
                                (click)="enviarDiagnostico()">Enviar diagnóstico
                            </div>
                            <div *ngIf="(data.datosEquipo.status == 1) && parent.validaListaPedientes()"
                                class="btn btn-success me-2" (click)="cambioStatusServicio('Concluir', 2)">Concluir
                            </div>
                            <div *ngIf="(data.datosEquipo.status == 1) && parent.validaListaPedientesEntregados()"
                                class="btn btn-warning me-2" (click)="cambioStatusServicio('Cancelar', 4)">Cancelar
                            </div>
                            <div *ngIf="(data.datosEquipo.status == 2 || data.datosEquipo.status == 4) && parent.validaOpcionesIndividuales()"
                                class="btn btn-warning me-2" (click)="cambioStatusServicio('Retomar', 1)">Retomar
                                servicio</div>
                            <div *ngIf="data.datosEquipo.status == 1 && parent.validaOpcionesIndividuales()"
                                class="btn btn-danger t-bold" style="float: right !important;"
                                (click)="eliminarEquipoOrden()"><i class="bi bi-trash"></i></div>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>